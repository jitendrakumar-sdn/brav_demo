<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brav</title>
    <link rel="stylesheet" href="../styles/bootstrap.css" type="text/css">
    <link rel="stylesheet" href="../styles/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="../styles/bootstrap-datetimepicker.min.css" />
    <link rel="stylesheet" href="../styles/style.css" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Raleway:400,400i,500,500i,600,600i,700" rel="stylesheet">
  

</head>

<body style="background: #FFF">

<% include ../header %>
    <div class="right-side-panel">
        <div class="container container-top-margin">
            <div class="col-md-8 create-availability">
                <h1>Hi <span id="myname"></span>,</h1>
                <h4>Get started by scheduling a session:</h4>
                <form>
                    <div class="form-group margin-top-feild">
                        <label class="txt-label col-sm-12 avaiblability-txt">Conflict name
                            <sup>*</sup>
                        </label>
                        <div class="col-sm-12 padding-zero">
                            <input type="text" placeholder="Conflict Name" id="Conflictname" class="birthdate">
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group margin-top-feild">
                        <label class="txt-label col-sm-12 avaiblability-txt">Availability
                            <sup>*</sup>
                        </label>
                        <div class='col-md-4'>
                            <div class="form-group">
                                <div class='input-group date' id='datestart'>
                                    <input type='text' class="form-control" />
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class='col-md-4'>
                            <div class="form-group">
                                <div class='input-group date' id='dateend'>
                                    <input type='text' class="form-control" />
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class='col-md-4'>
                            <div class="form-group">
                                <div class='input-group date' id='datetime'>
                                    <input type='text' class="form-control" />
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="clearfix"></div>
                    <!-- <div class="Add-availability">
                        <p>Add another available time
                            <a href="#">
                                <i class="fa fa-plus" aria-hidden="true"></i>
                            </a>
                        </p>
                    </div> -->
                    <div class="clearfix"></div>
                    <div class="form-group margin-top-feild">
                        <label class="txt-label col-sm-12 avaiblability-txt">Availability
                            <sup>*</sup>
                        </label>
                        <div class="col-sm-12 padding-zero">
                            <select name="" id="availability" class="birthdate" multiple="true">
                                <option value="">Select Availability</option>
                            </select>
                        </div>
                    </div>

                    <div class="clearfix"></div>
                    <div class="form-group margin-top-feild">
                        <label class="txt-label col-sm-12 avaiblability-txt">Describe the conflict
                            <sup>*</sup>
                        </label>
                        <div class="col-sm-12 padding-zero">
                            <textarea id="description"></textarea>
                        </div>
                    </div>
                    <p id="errMsg"></p>
                    <div class="clearfix"></div>
                    <div class="form-group margin-top-feild">
                        <div class="col-sm-offset-8 col-sm-4 padding-zero text-right">
                            <button class="btn btn-default login-btn" id="addSchedule">SUBMIT</button>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <p class="txt-password">Brav respects and protects your privacy. View full privacy policy
                        <a href="">here</a>.</p>

                </form>
            </div>
        </div>
    </div>
</body>

<script src="../js/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src='../js/moment.min.js'></script>
<script src="../js/bootstrap-datepicker.js"></script>
<script>
    $(document).ready(function () {

        if (sessionStorage.getItem('bravUser')) {
            var myname = JSON.parse(sessionStorage.getItem('bravUser'));
            $('#myname').text(myname.firstname + ' ' + myname.middlename + ' ' + myname.lastname)
        }

        $('#availability').select2();

        $('#datetime').datetimepicker({
            format: 'LT'
        });
        $('#datestart').datetimepicker({
            format: 'YYYY-MM-DD'
        });
        $('#dateend').datetimepicker({
            useCurrent: false, //Important! See issue #1075
            format: 'YYYY-MM-DD'
        });
        $("#datestart").on("dp.change", function (e) {
            $('#dateend').data("DateTimePicker").minDate(e.date);
        });
        $("#dateend").on("dp.change", function (e) {
            $('#datestart').data("DateTimePicker").maxDate(e.date);
        });


        $("#addSchedule").on('click', function (e) {
            e.preventDefault();
            $('errMsg').val('');
            var _name = $('#Conflictname').val();
            var _availability = JSON.stringify($('#availability').val());
            var _description = $('#description').val();
            var _start = $('#datestart').data('date');
            var _end = $('#dateend').data('date');
            var _time = $('#datetime').data('date');

            if (_name && _start && _end && _time && _availability && _description) {
                var data = {
                    title: _name,
                    start: _start,
                    end: _end,
                    time: _time,
                    availabilty: _availability,
                    description: _description,
                }
                $.ajax({
                    url: '/schedule/newschedule',
                    method: 'POST',
                    data: data,
                    success: function (res) {
                        if (res.success) {
                            window.location = '/schedule/done';
                        } else {
                            $('#errMsg').text(err.msg);
                        }
                    },
                    error: function (err) {
                        $('#errMsg').text(err.msg);
                    },
                    dataType: 'JSON'
                });
            } else {
                $('errMsg').val('Enter all fields');
            }
        });

        $.ajax({
            url: '/user/online',
            method: 'GET',
            success: function (res) {
                console.log('onlineuser res', res)
                if (res.success && res.data.length > 0) {
                    
                    for (var i = 0; i < res.data.length; i++) {
                        var option2 = new Option(res.data[i].firstname, res.data[i].firstname);
                        $('#availability').append(option2).trigger('change');
                    }
                } else {
                }
            },
            error: function (err) {
                console.log('Login error', err);
                $('#errMsg').text(err.msg);
            },
            dataType: 'JSON'
        });


    });

</script>

</html>